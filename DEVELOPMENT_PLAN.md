# План разработки OW–Sturtz Link

Общий план базовых файлов и вех. Сейчас в фокусе **ТЗ1** (выгрузка на пильный станок Stürtz); архитектура закладывается с расчётом на все **4 этапа** договора (ТЗ1–ТЗ4).

---

## 1. Цель по ТЗ1

Программа подключается к БД Firebird Optima WIN, показывает список групп оптимизации (GRORDERS), по выбранной группе формирует файл(ы) **.sob** с кадрами VER, KS, KT, KR, S (и при наличии настроек — W; в рамках ТЗ1 кадры W не делаем). Один выбранная группа = один набор файлов выгрузки. Формат — текст ASCII, спецификация Stürtz 2.05 и выше.

---

## 2. Базовые слои и файлы проекта

| Слой | Назначение | Задел на ТЗ2–ТЗ4 |
|------|------------|-------------------|
| **Проект, главная форма** | Точка входа, окно: подключение к БД, список групп, выбор группы, запуск выгрузки, путь сохранения. | Те же экран + позже пункты меню/экраны под этикетки (ТЗ3), настройки (ТЗ4). |
| **Подключение к БД (Firebird)** | Подключение/отключение к базе Optima WIN, проверка доступности. | Без изменений. |
| **Данные (модель + чтение из БД)** | Чтение GRORDERS для списка; по выбранной группе — данные для кадров KS, KT, KR, S из таблиц модуля оптимизации распила. | ТЗ2: данные для кадров W; ТЗ4: чтение/сохранение настроек маппинга и операций. |
| **Формат Sturtz (.sob)** | Формирование текста кадров VER, KS, KT, KR, S и запись в файл .sob. | ТЗ2: добавление кадров W в тот же .sob. |
| **Настройки / маппинг** | Соответствие полей БД и полей кадров Stürtz (ТЗ4). В ТЗ1 — минимальная реализация или заглушка (фиксированный маппинг). | ТЗ4: полноценный режим настройки. |

Итого базовые файлы: проект (.dpr), главная форма (.pas/.dfm), модуль доступа к Firebird, модуль данных/модели по группе оптимизации, модуль генерации .sob (Sturtz), модуль настроек/маппинга (заглушка). При необходимости — общий модуль типов/констант.

---

## 3. Вехи (без детализации)

1. **Каркас и подключение к БД**  
   Проект создан, главная форма открывается, реализовано подключение к Firebird (путь/параметры к базе Optima WIN). Проверка: программа подключается и отключается без падения.

2. **Список групп оптимизации**  
   Чтение из таблицы GRORDERS, отображение списка пользователю, выбор одной группы. Проверка: после выбора группа однозначно известна программе.

3. **Данные по выбранной группе**  
   По выбранной группе читаются из БД данные, необходимые для кадров KS, KT, KR, S (таблицы модуля оптимизации распила — по структуре БД и DESCRIBE). Проверка: данные в памяти достаточны для формирования кадров.

4. **Генерация .sob (ТЗ1)**  
   По подготовленным данным формируются кадры VER, KS, KT, KR, S и записываются в файл .sob (ASCII, по спецификации Stürtz 2.05+). Проверка: выходной файл сопоставим с эталонными из папки «Для выгрузки».

5. **Связка и задел**  
   Полный цикл: выбор группы → формирование и сохранение файла(ов) выгрузки в выбранную папку. Задел: место под подключение настроек маппинга (ТЗ4) и под кадры W (ТЗ2) без их реализации в ТЗ1.

---

## 4. Хранение данных подключения к БД

Данные для подключения к Firebird (Optima WIN) хранятся между сеансами работы программы.

- **Что хранить:** путь к файлу базы (или хост + путь при сетевом доступе), имя пользователя (логин), пароль, при необходимости — роль, кодировка, прочие параметры строки подключения Firebird.
- **Где хранить:** в конфигурационном файле **в папке приложения** (например, `config.ini` или `connection.cfg`). Конкретное имя файла — на этапе реализации. Пароль при необходимости хранить в зашифрованном виде или дать пользователю опцию «не сохранять пароль» (ввод при каждом запуске).
- **Как использовать:** при старте программа читает сохранённые параметры и подставляет их в форму/диалог подключения; пользователь может изменить их и переподключиться. Сохранение — по кнопке «Подключиться» / «Сохранить настройки» или при успешном подключении (на усмотрение реализации).

---

## 5. Что не входит в ТЗ1 (на потом)

- Кадры **W** (обрабатывающий центр) — ТЗ2 и настройки по ТЗ4.
- Режим **настройки** соответствия полей БД и Sturtz — ТЗ4.
- **Этикетки** — ТЗ3.
- Поддержка других станков и форматов — не планируется.

---

Документ можно дополнять по мере согласования и появления деталей.
