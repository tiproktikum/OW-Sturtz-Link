# Рабочее пространство и правила проекта OW–Sturtz Link

Документ описывает workspace, расположение артефактов и правила разработки программы на Delphi для выгрузки данных Optima WIN в формат станков Stürtz. При разработке и доработках программы ориентироваться на этот файл; при необходимости — дополнять его.

---

## Workspace (состав папок)

Workspace объединяет три корневые папки:

| Папка в workspace | Назначение |
|-------------------|------------|
| **OW–Sturtz Link** (текущий проект) | Корень проекта Delphi. Здесь располагаются исходники, проект, сборка, папки `temp` и `backup`. |
| **Клиенты/Контур, Тула, OW8** | Материалы заказчика: технические задания, эталонные файлы выгрузки, документация. |
| **Структуры БД/Структура БД Optima WIN 8.6** | Описание структуры БД Optima WIN (таблицы, поля, связи) — источник истины для запросов к Firebird. |

Файл workspace: `OW–Sturtz Link.code-workspace`.

---

## Этапы разработки (4 этапа)

Разработка ведётся по **четырём этапам**. У каждого этапа — **своё техническое задание**. Перед любыми изменениями или реализацией нужно однозначно понимать, **какой из четырёх этапов** выполняется, и руководствоваться соответствующим ТЗ.

| Этап | ТЗ | Содержание |
|------|----|------------|
| **1** | ТЗ1 | Выгрузка на пильный станок Stürtz: формирование файлов .sob (заголовок VER, кадры KS, KT, KR, S; при наличии настроек — кадры W). |
| **2** | ТЗ2 | Операции обработки деталей: формирование кадров **W** в файлах .sob для обрабатывающего центра Stürtz (только при настроенных операциях). |
| **3** | ТЗ3 | Этикетки Stürtz. |
| **4** | ТЗ4 | Настройка операций Stürtz. |

**Правило:** перед реализацией или правками всегда явно зафиксировать номер этапа (1–4) и открыть соответствующее ТЗ.

---

## Расположение ключевых артефактов

### Структура БД Optima WIN

- **Путь:** `Структуры БД/Структура БД Optima WIN 8.6/Структура БД Optima WIN 8.6.sql`
- **Назначение:** полное описание структуры БД Optima WIN (таблицы, поля, типы, индексы). Используется для написания запросов к СУБД Firebird и понимания источников данных для выгрузки в Stürtz.
- **Группы оптимизации:** в БД Firebird Optima WIN хранятся в таблице **GRORDERS**. Именно записи из GRORDERS нужно отображать пользователю для выбора той группы, по которой формировать файл выгрузки (1 выбранная группа = 1 набор файлов выгрузки).
- **Использование файла структуры:** в конце файла `Структура БД Optima WIN 8.6.sql` приведено много конструкций **DESCRIBE** по таблицам — по ним видно, в какой таблице какие данные лежат; при разработке запросов и маппинга полей эти DESCRIBE нужно использовать. В файле также есть **описания полей** (комментарии к полям таблиц) — их тоже нужно использовать при работе с БД.
- Дополнительные материалы по настройке фурнитуры и запросам могут находиться в подпапке `Работа по настройке фурнитуры` той же директории.

### Технические задания (ТЗ)

- **Папка:** `Клиенты/Контур, Тула, OW8/Техническое задание Sturtz, 01-2026`
- **Файлы ТЗ по этапам:**
  - **ТЗ1** — `ТЗ1_Выгрузка_на_пильный_станок_Sturtz.md`
  - **ТЗ2** — `ТЗ2_Операции_обработки_деталей_Sturtz.md`
  - **ТЗ3** — `ТЗ3_Этикетки_Sturtz.md`
  - **ТЗ4** — `ТЗ4_Настройка_операций_Sturtz.md`
- В этой же папке могут находиться договор, КП, счета, акты и прочая проектная документация; для разработки программы приоритетны файлы ТЗ1–ТЗ4.

### Эталонные файлы выгрузки на станок Sturtz

- **Папка:** `Клиенты/Контур, Тула, OW8/Для выгрузки`
- **Назначение:** реальные рабочие примеры выгрузки на станок Stürtz. Служат **эталоном** формата и содержимого при разработке и отладке программы.
- **Используемые в разработке форматы:**
  - **.sob** — параметры обработки (распил, операции); основной выход программы по ТЗ1/ТЗ2.
  - **.soe** — вспомогательные данные выгрузки (при необходимости по ТЗ).
- **Не используются в разработке:** файлы с расширениями **.wld** и **.f** — в реализации программы не участвуют, на них ориентироваться не нужно.
- Подпапка `Двери` содержит дополнительные примеры (в т.ч. .sob, .soe); эталонность распространяется и на неё, при этом по-прежнему учитываются только .sob и .soe.
- В папке также могут быть спецификации и описания (например, ProOpt, документы по отверстиям, инструментам ОЦ) — при необходимости использовать для уточнения формата.

### Описание формата файла Sturtz

- **Документация формата:** `Клиенты/Контур, Тула, OW8/Для выгрузки/ProOpt_DSatz_V205_Staba Russisch.md`
- **Статус:** это официальная детальная документация по формату принимаемого файла; использовать как основной источник формата.

### Тестовые результаты выгрузки

- **Папка:** `C:\Users\Timofey\Desktop\export sturtz\`
- **Назначение:** хранение тестовых результатов выгрузки для проверки и сравнения.

### Прототип программы (референс)

- **Путь:** `D:\Yandex.Disk\WORK\Project Delphi\Pertici Maker 3.3`
- **Назначение:** прототип программы с похожей логикой. Используется **только как референс** при разработке OW–Sturtz Link (архитектура, поток данных, UI).
- **Отличия прототипа от целевой программы:**
  - Подключается к БД **altAwin** (СУБД Firebird, но **другая структура** БД), а не к Optima WIN.
  - Выгрузка идёт на станок **Pertici**, а не Stürtz (другой формат файлов).
- **Общий смысл (как в прототипе, так и у нас):** программа подключается к БД Firebird, показывает список сменных заданий (они же «группы оптимизации», они же «Задания на изготовление»), даёт пользователю выбрать задание для выгрузки (1 задание = 1 набор файлов выгрузки) и выгружает данные и для распила профилей, и для обработки (сверление отверстий на деталях).
- В Pertici Maker 3.3 реализована выгрузка на **несколько типов станков** разными кнопками; в OW–Sturtz Link нужна выгрузка **только на Sturtz**, без выбора типа станка.
- **Правило:** **содержимое папки** `D:\Yandex.Disk\WORK\Project Delphi\Pertici Maker 3.3` **править запрещено**. Только чтение и использование кода/решений как референс; все изменения вносятся в проект OW–Sturtz Link.

---

## Правила проекта

### Транслитерация при выгрузке на станок

Станок Stürtz не поддерживает кириллицу. Все выгружаемые файлы (.sob, .soe и т.д.) и имена файлов выгрузки должны содержать только символы, поддерживаемые станцией (латиница, цифры, допустимые знаки).

- **Модуль:** `uTranslit.pas`, функция **CyrillicToLatin**. Транслитерация по ГОСТ 7.79-2000 (система B).
- **Где применять:** ко всем текстовым полям, попадающим в файлы выгрузки (.sob, .soe), и к имени файла выгрузки (напр. имя группы в имени .sob). При добавлении новых видов выгрузки — сразу подключать транслитерацию для всех текстовых данных.

### Временные файлы

- Все временные файлы, создаваемые в процессе разработки или работы программы, должны размещаться в папке **temp** в корне проекта (OW–Sturtz Link).

### Удаление файлов

- Файлы, которые по логике разработки подлежат удалению, **не удалять**. Переносить их в папку **backup** в корне проекта.

### Папки в корне проекта

- **temp** — временные файлы.
- **backup** — файлы, выведенные из активной разработки (вместо удаления).

---

## Краткая памятка для нейросети / разработчика

1. **Этап:** всегда определять, какой из 4 этапов (1–4) в работе, и открывать соответствующее ТЗ в папке «Техническое задание Sturtz, 01-2026».
2. **БД:** структура таблиц и полей — в `Структура БД Optima WIN 8.6.sql`; группы оптимизации — таблица **GRORDERS** (её записи показывать пользователю для выбора). В конце SQL-файла — DESCRIBE по таблицам и описания полей; использовать при запросах и маппинге.
3. **Эталон выгрузки:** рабочие примеры — в папке «Для выгрузки»; ориентир — файлы **.sob** и **.soe**; форматы **.wld** и **.f** в разработке не используются.
4. **Прототип:** референс — `D:\Yandex.Disk\WORK\Project Delphi\Pertici Maker 3.3` (altAwin → Pertici). Папку прототипа **не править**, только читать.
5. **Временные файлы:** только в `temp`; снятые с использования файлы переносить в `backup`, не удалять.
6. **Транслитерация:** станок не поддерживает кириллицу; все тексты в выгрузке (.sob, .soe) и имена файлов — через **CyrillicToLatin** (uTranslit.pas).

При доработке программы этот файл можно расширять: добавлять ссылки на новые документы, уточнять пути, правила и этапы.
